<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube Sync & Chat â€” Butterfly</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: {} } };
  </script>
  <style>
    /* Butterfly color palette */
    :root{
      --butterfly-1: #9b5de5; /* purple */
      --butterfly-2: #f15bb5; /* pink */
      --butterfly-3: #00b4d8; /* teal */
      --bg-dark: #0e0f12;
      --panel: #17181a;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background: linear-gradient(180deg, #06060a 0%, #0b0b0f 60%);
      color:#fff;min-height:100vh;padding:0;
    }

    /* Landing / Front page */
    .landing{
      height:100vh;display:flex;align-items:center;justify-content:center;padding:32px;
      background: radial-gradient(800px 400px at 10% 20%, rgba(155,93,229,0.12), transparent),
                  radial-gradient(700px 350px at 90% 80%, rgba(241,91,181,0.08), transparent),
                  linear-gradient(180deg,#071021 0%, #0b0f1a 100%);
    }

    .hero-card{max-width:980px;width:100%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:20px;padding:36px;box-shadow:0 20px 60px rgba(3,6,15,0.7);border:1px solid rgba(255,255,255,0.03);display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center}

    .butterfly-graphic{display:flex;flex-direction:column;align-items:flex-start;gap:14px}
    .logo{width:120px;height:120px;border-radius:18px;background:linear-gradient(135deg,var(--butterfly-1),var(--butterfly-2));display:flex;align-items:center;justify-content:center;box-shadow:0 12px 30px rgba(155,93,229,0.18);overflow:hidden}
    .logo img{width:90%;height:90%;object-fit:contain;filter:drop-shadow(0 6px 18px rgba(155,93,229,0.18));}
    h1{font-size:32px;color:var(--butterfly-1);font-weight:700}
    p.lead{color:rgba(255,255,255,0.8);max-width:520px}

    .cta-buttons{display:flex;gap:12px;margin-top:6px}
    .btn{
      padding:12px 18px;border-radius:12px;border:0;cursor:pointer;font-weight:600;letter-spacing:0.2px
    }
    .btn-primary{background:linear-gradient(90deg,var(--butterfly-1),var(--butterfly-2));color:white;box-shadow:0 8px 30px rgba(155,93,229,0.16)}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:rgba(255,255,255,0.9)}

    .sneak{font-size:12px;color:rgba(255,255,255,0.6);margin-top:8px}

    /* App wrapper - hidden until Enter pressed */
    .app{display:none;padding:28px}

    header.app-header{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:12px}
    .brand .mini{width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--butterfly-2),var(--butterfly-3));display:flex;align-items:center;justify-content:center}
    .brand h2{font-size:18px;color:var(--butterfly-1);font-weight:700}

    .online-users{display:flex;gap:8px;align-items:center}
    .user-avatar{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}

    .panel{background:linear-gradient(180deg,var(--panel),rgba(255,255,255,0.02));padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);}

    .youtube-player{background:#000;border-radius:10px;overflow:hidden;box-shadow:0 18px 50px rgba(0,0,0,0.6);}

    /* chat */
    .chat-area{display:flex;flex-direction:column;height:420px}
    .messages{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
    .message-bubble{max-width:80%;border-radius:14px;padding:10px 12px}
    .message-bubble.own{align-self:flex-end;background:linear-gradient(90deg,var(--butterfly-2),var(--butterfly-3));color:#fff}
    .message-bubble.other{align-self:flex-start;background:rgba(255,255,255,0.03);color:#fff}
    .message-bubble.system{align-self:center;background:transparent;color:rgba(255,255,255,0.6);font-style:italic}

    .controls{display:flex;gap:8px;margin-top:12px}

    /* small responsive */
    @media (max-width:920px){
      .hero-card{grid-template-columns:1fr;}
      .hero-card .butterfly-graphic{align-items:center;text-align:center}
    }
  </style>
</head>
<body>

  <!-- Landing / Front page -->
  <section class="landing" id="landing">
    <div class="hero-card">
      <div class="butterfly-graphic">
        <div class="logo" aria-hidden="true">
          <!-- Replace the src with your local file path or hosted image -->
          <img src="assets/butterfly-logo.png" alt="Butterfly logo" id="butterflyLogo">
        </div>
        <h1>Butterfly â€” Watch Together</h1>
        <p class="lead">A buttery-smooth watch party app with synchronized YouTube playback and live chat. Designed for cozy viewing â€” invite one friend and enjoy together.</p>
        <div class="cta-buttons">
          <button class="btn btn-primary" id="enterBtn">Enter the App</button>
          <button class="btn btn-ghost" id="demoBtn">Try Demo</button>
        </div>
        <div class="sneak">Limit: Up to <strong>2</strong> members per room (you + 1 friend). Replace the logo at <code>assets/butterfly-logo.png</code>.</div>
      </div>

      <div style="display:flex;flex-direction:column;gap:10px">
        <div class="panel">
          <h3 style="color:var(--butterfly-1);margin-bottom:8px">How it works</h3>
          <ol style="color:rgba(255,255,255,0.8);margin-left:14px;line-height:1.6">
            <li>Enter a name and create or join a room.</li>
            <li>Share the room ID with 1 friend.</li>
            <li>Paste a YouTube URL to start synchronized playback.</li>
          </ol>
        </div>

        <div class="panel" style="display:flex;gap:10px;align-items:center">
          <div style="width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,var(--butterfly-1),var(--butterfly-2));display:flex;align-items:center;justify-content:center">âœ¨</div>
          <div>
            <strong style="color:var(--butterfly-1)">Designed for two</strong>
            <p style="color:rgba(255,255,255,0.8);font-size:13px;margin-top:4px">A focused experience â€” no large groups, just you and a friend.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- App (hidden by default) -->
  <section class="app max-w-7xl mx-auto" id="app" style="display:none">
    <header class="app-header">
      <div class="brand">
        <div class="mini">ðŸ¦‹</div>
        <div>
          <h2>Butterfly â€” YouTube Sync & Chat</h2>
          <div style="font-size:12px;color:rgba(255,255,255,0.6)">Room: <span id="currentRoomId">â€”</span></div>
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:12px">
        <div class="online-users" id="onlineUsersHeader">
          <!-- avatars added dynamically -->
        </div>
        <div style="font-size:13px;color:rgba(255,255,255,0.7)" id="onlineCountHeader">0 online</div>
      </div>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-6">
      <!-- Video + controls (2/3 width) -->
      <div class="lg:col-span-2">
        <div class="youtube-player panel">
          <div id="player" class="w-full aspect-video"></div>
        </div>

        <div class="panel mt-4">
          <div class="controls">
            <button id="playBtn" class="btn btn-primary">Play</button>
            <button id="pauseBtn" class="btn btn-ghost">Pause</button>
            <input id="videoUrl" class="bg-transparent border border-gray-700 rounded px-3 py-2 flex-1" placeholder="Paste YouTube URL" />
            <button id="loadVideo" class="btn btn-primary">Load</button>
          </div>
        </div>
      </div>

      <!-- Chat (1/3 width) -->
      <div class="panel chat-area">
        <div style="border-bottom:1px solid rgba(255,255,255,0.03);padding-bottom:12px;margin-bottom:8px">
          <h3 style="color:var(--butterfly-1)">Group Chat</h3>
          <div style="font-size:12px;color:rgba(255,255,255,0.6)">Up to 2 members</div>
        </div>

        <div class="messages" id="chatMessages"></div>

        <div style="border-top:1px solid rgba(255,255,255,0.03);padding-top:12px;margin-top:8px">
          <div style="display:flex;gap:8px">
            <input id="chatInput" placeholder="Type a message..." class="flex-1 bg-transparent border border-gray-700 rounded px-3 py-2" />
            <button id="sendBtn" class="btn btn-primary">Send</button>
          </div>
          <div id="typingIndicator" style="font-size:12px;color:rgba(255,255,255,0.6);margin-top:8px;display:none">Someone is typing...</div>
        </div>
      </div>
    </main>

    <!-- Extra info -->
    <div style="max-width:980px;margin:22px auto 0;">
      <div class="panel">
        <strong style="color:var(--butterfly-1)">Tip:</strong> For best sync keep a stable internet connection. This demo simulates sync behaviour locally â€” a real deployment would use a small server / WebSocket.
      </div>
    </div>
  </section>

  <!-- Connection Modal (simplified) -->
  <div id="connectionModal" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:80;display:none">
    <div style="width:460px;background:var(--panel);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)">
      <h3 style="color:var(--butterfly-1);margin-bottom:10px">Join a Watch Party</h3>
      <label style="font-size:13px;color:rgba(255,255,255,0.7)">Your name</label>
      <input id="userName" class="w-full mt-2 mb-4 bg-transparent border border-gray-700 rounded px-3 py-2" placeholder="Enter your name" />
      <div style="display:flex;gap:10px">
        <button id="createRoomBtn" class="btn btn-primary flex-1">Create Room</button>
        <button id="joinRoomBtn" class="btn btn-ghost flex-1">Join Room</button>
      </div>
      <div id="joinRoomSection" style="display:none;margin-top:12px">
        <label style="font-size:13px;color:rgba(255,255,255,0.7)">Room ID</label>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input id="roomId" class="flex-1 bg-transparent border border-gray-700 rounded px-3 py-2" placeholder="Enter room ID" />
          <button id="confirmJoinBtn" class="btn btn-primary">Join</button>
        </div>
      </div>
      <div id="roomCreatedSection" style="display:none;margin-top:12px">
        <div style="display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px">
          <div style="font-family:monospace;font-weight:700" id="roomIdDisplay">ROOM1234</div>
          <button id="copyRoomIdBtn" class="btn btn-ghost">Copy</button>
        </div>
        <button id="startWatchingBtn" class="btn btn-primary w-full mt-8">Start Watching</button>
      </div>
    </div>
  </div>

  <!-- YouTube API + App Script -->
  <script>
    // ----- App state and simulated socket (keeps demo local) -----
    const appState = {
      currentUser: null,
      currentRoom: null,
      users: [],
      maxMembers: 2,
      socketListeners: {},
      socket: {
        emit: (event,data) => {
          // Simulate network latency
          if(event === 'create_room'){
            setTimeout(()=>{
              const roomId = generateRoomId();
              appState.socketListeners['room_created']?.({roomId, users:[appState.currentUser]});
            },400);
          }
          else if(event === 'join_room'){
            setTimeout(()=>{
              // Simulate existing one other user (so total becomes 2)
              const other = {id:'user_other', name:'Friend', color:'linear-gradient(90deg, var(--butterfly-1), var(--butterfly-2))'};
              const users = [data.user, other];
              appState.socketListeners['user_joined']?.({user:data.user, users});
            },600);
          }
          else if(event === 'player_action'){
            setTimeout(()=>{
              appState.socketListeners['player_action']?.(data);
            },120);
          }
          else if(event === 'send_message'){
            setTimeout(()=>{
              // Simulate a short reply from the other user (if present)
              const other = appState.users.find(u=>u.id !== appState.currentUser.id);
              if(other){
                appState.socketListeners['message']?.({user:other, text: 'Nice!', timestamp: new Date().toISOString()});
              }
            },800 + Math.random()*1200);
          }
        },
        on: (event,cb)=>{appState.socketListeners[event]=cb}
      }
    };

    function generateRoomId(){return Math.random().toString(36).substring(2,10).toUpperCase();}
    function generateUserId(){return 'u_'+Math.random().toString(36).substring(2,8)}

    // ----- UI helpers -----
    function showLanding(show){document.getElementById('landing').style.display = show ? 'flex' : 'none';}
    function showApp(show){document.getElementById('app').style.display = show ? 'block' : 'none';}
    function showModal(show){document.getElementById('connectionModal').style.display = show ? 'flex' : 'none';}

    // Landing actions
    document.getElementById('enterBtn').addEventListener('click', ()=>{
      showLanding(false); showApp(true); showModal(true);
      // initialise socket listeners
      initSocketListeners();
    });
    document.getElementById('demoBtn').addEventListener('click', ()=>{
      // Quick demo: prefill name and create a room
      document.getElementById('userName').value = 'You';
      document.getElementById('createRoomBtn').click();
    });

    // Modal actions
    document.getElementById('createRoomBtn').addEventListener('click', ()=>{
      const name = document.getElementById('userName').value.trim();
      if(!name) return alert('Please enter your name');
      appState.currentUser = {id:generateUserId(), name, color:'gradient'};
      appState.socket.emit('create_room',{user:appState.currentUser});
    });
    document.getElementById('joinRoomBtn').addEventListener('click', ()=>{
      const name = document.getElementById('userName').value.trim();
      if(!name) return alert('Please enter your name');
      appState.currentUser = {id:generateUserId(), name, color:'gradient'};
      document.getElementById('joinRoomSection').style.display = 'block';
    });
    document.getElementById('confirmJoinBtn').addEventListener('click', ()=>{
      const roomId = document.getElementById('roomId').value.trim();
      if(!roomId) return alert('Please enter a room ID');
      appState.currentRoom = roomId;
      appState.socket.emit('join_room', {roomId, user:appState.currentUser});
    });

    document.getElementById('copyRoomIdBtn').addEventListener('click', ()=>{
      const id = document.getElementById('roomIdDisplay').textContent;
      navigator.clipboard?.writeText(id).then(()=>alert('Room ID copied'))
    });
    document.getElementById('startWatchingBtn').addEventListener('click', ()=>{
      showModal(false);
      document.getElementById('currentRoomId').textContent = appState.currentRoom || document.getElementById('roomIdDisplay').textContent;
      updateOnlineUsers();
      addMessageToChat('System','Welcome! Paste a YouTube URL to start synchronized playback.', false, true);
    });

    // ----- Socket handlers -----
    function initSocketListeners(){
      appState.socket.on('room_created', handleRoomCreated);
      appState.socket.on('user_joined', handleUserJoined);
      appState.socket.on('player_action', handlePlayerAction);
      appState.socket.on('message', handleChatMessage);
    }

    function handleRoomCreated(data){
      appState.currentRoom = data.roomId;
      appState.users = data.users;
      document.getElementById('roomCreatedSection').style.display = 'block';
      document.getElementById('joinRoomSection').style.display = 'none';
      document.getElementById('roomIdDisplay').textContent = data.roomId;
    }

    function handleUserJoined(data){
      // enforce max members (demo)
      if(data.users.length > appState.maxMembers){
        alert('Room is full (max 2 members)');
        return;
      }
      appState.users = data.users;
      appState.currentRoom = appState.currentRoom || data.roomId;
      updateOnlineUsers();
      addMessageToChat('System', `${data.user.name} joined the room`, false, true);
    }

    function handlePlayerAction(data){
      if(!window.player) return;
      if(data.userId === appState.currentUser?.id) return; // ignore our own
      if(data.action === 'play') player.playVideo();
      else if(data.action === 'pause') player.pauseVideo();
      else if(data.action === 'load') player.loadVideoById(data.videoId);
    }

    function handleChatMessage(data){
      const isOwn = data.user.id === appState.currentUser.id;
      addMessageToChat(data.user.name, data.text, isOwn);
    }

    // ----- UI helpers: online users and chat -----
    function updateOnlineUsers(){
      const container = document.getElementById('onlineUsersHeader');
      const count = document.getElementById('onlineCountHeader');
      container.innerHTML = '';
      appState.users.forEach(u=>{
        const d = document.createElement('div');
        d.className = 'user-avatar';
        d.style.background = 'linear-gradient(90deg,var(--butterfly-1),var(--butterfly-2))';
        d.textContent = u.name.charAt(0).toUpperCase();
        container.appendChild(d);
      });
      count.textContent = `${appState.users.length} online`;
    }

    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');

    function addMessageToChat(user, text, isOwn=false, isSystem=false){
      const div = document.createElement('div');
      div.className = `message-bubble ${isOwn? 'own' : (isSystem? 'system' : 'other')}`;
      if(!isOwn && !isSystem){
        const u = document.createElement('div'); u.style.fontSize='12px'; u.style.opacity='0.85'; u.style.marginBottom='6px'; u.textContent = user; div.appendChild(u);
      }
      const t = document.createElement('div'); t.textContent = text; div.appendChild(t);
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    sendBtn.addEventListener('click', ()=>{
      const msg = chatInput.value.trim(); if(!msg) return; addMessageToChat('You', msg, true); chatInput.value='';
      appState.socket.emit('send_message',{roomId:appState.currentRoom,userId:appState.currentUser.id,text:msg});
    });

    chatInput.addEventListener('input', ()=>{document.getElementById('typingIndicator').style.display='block'; clearTimeout(window._t); window._t = setTimeout(()=>{document.getElementById('typingIndicator').style.display='none'},900)});
    chatInput.addEventListener('keypress',(e)=>{if(e.key==='Enter') sendBtn.click();});

    // ----- YouTube API -----
    var tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; document.head.appendChild(tag);
    var player;
    function onYouTubeIframeAPIReady(){
      player = new YT.Player('player',{height:'100%',width:'100%',videoId:'dQw4w9WgXcQ',playerVars:{'playsinline':1,'modestbranding':1,'rel':0},events:{'onReady':onPlayerReady}});
    }
    function onPlayerReady(e){console.log('YT ready')}

    document.getElementById('playBtn').addEventListener('click', ()=>{if(player) player.playVideo(); appState.socket.emit('player_action',{roomId:appState.currentRoom,userId:appState.currentUser.id,action:'play'})});
    document.getElementById('pauseBtn').addEventListener('click', ()=>{if(player) player.pauseVideo(); appState.socket.emit('player_action',{roomId:appState.currentRoom,userId:appState.currentUser.id,action:'pause'})});

    document.getElementById('loadVideo').addEventListener('click', ()=>{
      const url = document.getElementById('videoUrl').value.trim(); if(!url) return alert('Paste a YouTube URL');
      const id = extractVideoId(url); if(!id) return alert('Invalid URL');
      if(player) player.loadVideoById(id);
      appState.socket.emit('player_action',{roomId:appState.currentRoom,userId:appState.currentUser.id,action:'load',videoId:id});
    });

    function extractVideoId(url){ const reg = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/; const m = url.match(reg); return (m && m[7].length===11)? m[7]: null }

    // Initialize demo with small sample when page loads (keeps landing visible)
    window.addEventListener('load', ()=>{
      // nothing auto; user will press Enter
    });
  </script>
</body>
</html>
